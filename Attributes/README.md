# Атрибуты
_________________________________________________________________________________________
#### Атрибуты имеют следующие особенности: ####

* добавляют в программу метаданные (сведения о типах, определенных в программе), через
пользовательские атрибуты можно указать любую дополнительную информацию.

* один или несколько атрибутов применимы ко всей сборке, к модулю или к более мелким
элементам (классам, свойствам...).

* могут принимать аргументы, так же как методы и свойства.

* посредством отражения программа проверяет собственные метаданные или метаданные в
других программах.

Атрибуты можно использовать почти в любых объявлениях (можно ограничить типы допустимых
объявлений).
```c#
[Serializable]
public class SampleClass
{
    // объекты этого типа могут быть сериализованы
}
```

Все имена атрибутов заканчиваются суффиксом Attribute, но при использовании атрибута в
коде этот суффикс можно не указывать – ```[DllImport]``` эквивалентно ```[DllImportAttribute]```.

Многие атрибуты имеют позиционные, необязательные или именованные параметры:

1. Позиционные параметры не могут опускаться и должны указываться вначале.

2. Именованные параметры являются необязательными, могут указываться в любом порядке.
```c#
[DllImport("user32.dll")]
[DllImport("user32.dll", SetLastError=false, ExactSpelling=false)]
[DllImport("user32.dll", ExactSpelling=false)]
```

Целевой объект атрибута – это сущность, к которой применяется атрибут. По умолчанию
атрибут применяется к тому элементу, перед которым он указан.
Чтобы явным образом определить целевой объект атрибута:
```c#
[target : attribute-list]
```

где ```target```:

* ```assembly``` – вся сборка.

* ```module``` – модуль текущей сборки.

* ```field```* – поле в классе или структуре.

* ```event``` – событие.

* ```method``` – метод, либо методы доступа к свойствам ```get``` и ```set```.

* ```param``` – параметры метода или параметры метода доступа ```set```.

* ```property``` – свойство.

* ```return``` – возвращаемое значение метода, индексатора свойства или метода доступа к
свойствам ```get```.

* ```type``` – структура, класс, интерфейс, перечисление или делегат.

*целевое значение ```field``` устанавливает атрибут резервной переменной автоматически
реализуемого свойства

```c#
// default: применяется к методу
[ValidatedContract]
int Method1() { return 0; }

// применяется к методу
[method: ValidatedContract]
int Method2() { return 0; }

// применяется к возвращаемому значению
[return: ValidatedContract]
int Method3() { return 0; }
```

Вне зависимости от целевых объектов ```AttributeUsage```, для которых действует атрибут,
необходимо явно задать целевой объект для ```return```.
(компилятор не использует сведения ```AttributeUsage``` для разрешения конфликтов
неоднозначности).
_________________________________________________________________________________________
#### Глобальные атрибуты ####

Глобальные атрибуты – применяются ко всей сборке или модулю. Например, атрибут
```AssemblyVersionAttribute``` можно использовать для встраивания сведений о версии в сборку:
```c#
[assembly: AssemblyVersion("1.0.0.0")]
```
Глобальные атрибуты отображаются в исходном коде после любых директив ```using``` верхнего
уровня и перед всеми объявлениями типов.

В проектах C# глобальные атрибуты помещаются в файл ```AssemblyInfo.cs```.


#### Атрибуты сборки – это значения, которые предоставляют сведения о сборке: ####

1. Атрибуты удостоверения сборки.

2. Информационные атрибуты.

3. Атрибуты манифеста сборки.

Атрибуты удостоверения сборки определяют удостоверение сборки (имя, версию, язык и
региональные параметры), формируют полное имя сборки и являются обязательными при ссылке
на неё в коде.

 – ```AssemblyName``` полностью описывает удостоверение сборки.

 – ```AssemblyVersionAttribute``` задает версию сборки.

 – ```AssemblyCultureAttribute``` указывает, какой язык и региональные параметры поддерживает
сборка.

 – ```AssemblyFlagsAttribute``` указывает, поддерживает ли сборка параллельное выполнение на одном
компьютере, в одном процессе или в одном домене приложения.

Информационные атрибуты можно использовать для предоставления дополнительных сведений о
компании или продукте в сборке.

 – ```AssemblyProductAttribute``` определяет настраиваемый атрибут, задающий имя продукта для
манифеста сборки.

 – ```AssemblyTrademarkAttribute``` определяет настраиваемый атрибут, задающий товарный знак для
манифеста сборки.

 – ```AssemblyInformationalVersionAttribute``` определяет настраиваемый атрибут, задающий
информационную версию для манифеста сборки.

 – ```AssemblyCompanyAttribute``` определяет настраиваемый атрибут, задающий название организации
для манифеста сборки.

 – ```AssemblyCopyrightAttribute``` определяет настраиваемый атрибут, задающий уведомление об
авторских правах для манифеста сборки.

 – ```AssemblyFileVersionAttribute``` дает компилятору указание использовать определенный номер
версии для ресурса версии файла Win32.

 – ```CLSCompliantAttribute``` указывает, соответствует ли сборка спецификации CLS.

Атрибуты манифеста сборки можно использовать для предоставления сведений в манифесте
сборки (заголовок, описание, псевдоним по умолчанию и конфигурация).

 – ```AssemblyTitleAttribute``` определяет настраиваемый атрибут, задающий название сборки для
манифеста сборки.

 – ```AssemblyDescriptionAttribute``` определяет настраиваемый атрибут, задающий описание сборки
для манифеста сборки.

 – ```AssemblyConfigurationAttribute``` определяет настраиваемый атрибут, задающий конфигурацию
сборки для манифеста сборки.

 – ```AssemblyDefaultAliasAttribute``` определяет понятный псевдоним по умолчанию для манифеста
сборки.
_________________________________________________________________________________________
#### Создание настраиваемых атрибутов ####

Например, требуется пометить тип тегом с именем разработчика, для этого можно определить
класс настраиваемых атрибутов ```Author```:

1. определяется класс атрибута, наследующий от ```System.Attribute```, где имя класса – это
имя атрибута ```Author```.

a. параметры конструктора являются позиционными параметрами настраиваемого атрибута
(в данном случае ```name``` позиционный параметр).

b. все открытые поля или свойства, доступные для чтения и записи, являются именованными
параметрами (в данном случае ```version``` именованный параметр).

2. используется атрибут ```AttributeUsage```, делающий атрибут ```Author``` допустимым только для
класса, объявлений ```struct``` и отдельных методов класса.

a. ```AttributeUsage``` имеет именованный параметр ```AllowMultiple```, выставляющий для
настраиваемого атрибута однократное или многократное использование.

![screen capture 1](01.png)

_________________________________________________________________________________________
#### Обращение к атрибутам с помощью отражения ####

Отражение позволяет извлекать сведения, определённые с настраиваемыми атрибутами.
Метод ```GetCustomAttributes``` возвращает массив объектов, являющихся эквивалентами атрибутов
исходного кода во время выполнения.

В примере, представленном выше, спецификация атрибута ```Author```
```c#
[Author("R. Koch", version = 1.3)]  
public class SampleClass
```
эквивалентна следующему коду:
```c#
Author anonymousAuthorObject = new Author("R. Koch");  
anonymousAuthorObject.version = 1.3;
```
Однако, код не выполняется до тех пор, пока у ```SampleClass``` не будут запрошены атрибуты.

#### Таким образом, вызов метода ```GetCustomAttributes``` в ```SampleClass``` приведет к тому, что объект ####
#### ```Author``` будет создан и инициализирован так, как показано выше. ####
Метод ```GetCustomAttributes``` возвращает объект ```Author``` и все другие объекты атрибутов в
массиве.

![screen capture 2](02.png)

*определение атрибута должно находиться в текущем пространстве имён, иначе должно
вводиться пространство имён с определением нужного атрибута


Опрашивается объект ```Type```, чтобы получить данные об атрибуте на уровне класса.

#### Можно также использовать члены класса ```Type```, чтобы получить отдельные методы и члены ####
#### переданного класса: ####

Для этого выполняется метод ```Type.GetMethods```, помещающий экземпляры всех методов в массив
объектов ```System.Reflection.MemberInfo``` и получаются данные об атрибуте на уровне методов.
Аналогичным образом можно найти атрибуты на уровне свойств используя метод
```Type.GetProperties```.
_________________________________________________________________________________________
